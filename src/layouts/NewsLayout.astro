---
import BaseLayout from './BaseLayout.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import AdsSlot from '../components/AdsSlot.astro';
import SearchOverlay from '../components/SearchOverlay.astro';

type FM = {
  title: string;
  description?: string;
  pubDate: string | Date;
  updatedDate?: string | Date;
  tags?: string[];
  cover?: string;
};

const { frontmatter } = Astro.props as { frontmatter: FM };

const canonical = new URL(Astro.url.pathname, Astro.site);
const pubISO = new Date(frontmatter.pubDate).toISOString();
const updISO = frontmatter.updatedDate ? new Date(frontmatter.updatedDate).toISOString() : undefined;

// JSON-LD Article
const articleLD = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: frontmatter.title,
  description: frontmatter.description,
  datePublished: pubISO,
  ...(updISO ? { dateModified: updISO } : {}),
  image: frontmatter.cover ? [frontmatter.cover] : undefined,
  mainEntityOfPage: String(canonical),
};
---

<BaseLayout
  title={frontmatter.title}
  description={frontmatter.description}
  canonical={canonical}
  ogImage={frontmatter.cover}
  type="article"
>
  <Fragment slot="search"><SearchOverlay /></Fragment>

  <section class="mx-auto max-w-7xl container-px mt-8 grid gap-8 lg:grid-cols-[1fr_minmax(720px,760px)_1fr]">
    <div class="hidden lg:block"></div>

    <article class="prose prose-invert max-w-[760px] w-full">
      <Breadcrumbs items={[
        { name: 'News', href: '/news/' },
        { name: frontmatter.title }
      ]} />

      <h1>{frontmatter.title}</h1>

      <p class="text-sm text-text2">
        <time datetime={pubISO}>{new Date(frontmatter.pubDate).toLocaleDateString('en-US')}</time>
        {frontmatter.updatedDate && (
          <span> â€¢ Updated <time datetime={updISO}>{new Date(frontmatter.updatedDate).toLocaleDateString('en-US')}</time></span>
        )}
      </p>

      {frontmatter.cover && (
        <img
          src={frontmatter.cover}
          alt={frontmatter.title}
          loading="lazy"
          decoding="async"
          class="w-full aspect-[16/9] object-cover rounded-card shadow-soft border border-border/60"
        />
      )}

      <!-- Ad nach Hero -->
      <div class="ad-box aspect-video mt-6">
        <AdsSlot name="news-top" height={160} class="mt-0" />
      </div>

      <slot />

      <!-- Ad am Artikelende -->
      <div class="ad-box aspect-video mt-8">
        <AdsSlot name="news-bottom" height={240} class="mt-0" />
      </div>
    </article>

    <div class="hidden lg:block"></div>
  </section>

  <script type="application/ld+json" is:inline set:html={JSON.stringify(articleLD)} />
</BaseLayout>
