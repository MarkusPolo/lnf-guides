---
import { getCollection } from 'astro:content';
import GuideLayout from '../../../layouts/GuideLayout.astro';

export async function getStaticPaths() {
  const entries = await getCollection('guides');
  return entries.map((e) => {
    const [category, ...rest] = e.slug.split('/');
    return { params: { category, slug: rest.join('/') } };
  });
}

const { category, slug } = Astro.params;
const fullSlug = `${category}/${slug}`;

const entry = (await getCollection('guides')).find((e) => e.slug === fullSlug);
if (!entry) return Astro.redirect('/404');

const { Content, headings } = await entry.render();
const fm = entry.data;
---

<GuideLayout frontmatter={fm} headings={headings} currentSlug={fullSlug}>
  <Content />
</GuideLayout>
